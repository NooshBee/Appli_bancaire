function lockFlowersClicks(lock){
  // bloque/dÃ©bloque les clics sur toutes les fleurs
  for (const s of flowersState){
    s.el.style.pointerEvents = lock ? "none" : "auto";
  }
}

function gatherFlowersToBouquet(durationMs = 1200){
  return new Promise((resolve) => {
    // stop rebonds
    stopAnimation();

    // Ã©viter que des cartes sâ€™ouvrent pendant lâ€™anim
    isLocked = true;
    lockFlowersClicks(true);

    const w = window.innerWidth;
    const h = window.innerHeight;

    // centre "bouquet" : un peu au-dessus du milieu (plus joli)
    const cx = w * 0.5;
    const cy = h * 0.48;

    // petit Ã©ventail : plus on est "loin" dans la liste, plus on sâ€™Ã©carte
    const total = flowersState.length;

    // transitions CSS (on anime transform)
    for (let i = 0; i < total; i++){
      const s = flowersState[i];

      // lÃ©gÃ¨re forme ovale (option A+)
      const t = i / (total - 1);
      const angle = t * Math.PI * 2;

      // rayon ovale
      const rx = 70;
      const ry = 95;

      // dispersion douce autour du centre (Ã©vite pile parfaite)
      const tx = cx + Math.cos(angle) * rx + rand(-14, 14);
      const ty = cy + Math.sin(angle) * ry + rand(-14, 14);

      // animation via transition (important: set then render)
      s.el.style.transition = `transform ${durationMs}ms cubic-bezier(.2,.9,.2,1)`;
      s.x = tx;
      s.y = ty;
      renderOne(s);
    }

    // quand c'est fini
    setTimeout(() => {
      // nettoie transition pour la suite
      for (const s of flowersState){
        s.el.style.transition = "";
      }
      resolve();
    }, durationMs + 30);
  });
}





async function playGiftSequence(includeBougain){
  isLocked = true;
  hideAllScreens();
  if (topHeader) topHeader.classList.add("hideTop");
  stopProposalTimer();

  // ðŸŒ¸ bouquet qui se forme
  await gatherFlowersToBouquet(1200);

  // â³ au lieu de 5s -> tu avais demandÃ© 2s
  setTimeout(() => {
    gift.classList.remove("hidden");
    setupTapToOpenGift(includeBougain);

    // (facultatif) garder les fleurs bloquÃ©es pendant le cadeau
    // lockFlowersClicks(true);

    isLocked = false;
  }, 2000);
}



